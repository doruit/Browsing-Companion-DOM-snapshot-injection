INFO:     Will watch for changes in these directories: ['/Users/doruit/Browsing-Companion-DOM-snapshot-injection/services/ai-service']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [19488] using WatchFiles
INFO:     Started server process [19559]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     127.0.0.1:62561 - "GET /utility/recipe-images/random?count=10&t=1764180689685 HTTP/1.1" 404 Not Found
Error fetching preferences: (Unauthorized) The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
docs
dbs/browsing-companion-db/colls/preferences/docs/test
wed, 26 nov 2025 18:11:29 gmt

'
ActivityId: 6630726b-7e7a-4de1-a2df-182e16820d01, Microsoft.Azure.Documents.Common/2.14.0
Code: Unauthorized
Message: The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
docs
dbs/browsing-companion-db/colls/preferences/docs/test
wed, 26 nov 2025 18:11:29 gmt

'
ActivityId: 6630726b-7e7a-4de1-a2df-182e16820d01, Microsoft.Azure.Documents.Common/2.14.0
OpenAI Response: ChatCompletion(id='chatcmpl-CgEHD21eoC3xMfhS2NInQL7gLnRHr', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='## ðŸ‘‹ Hello There!\n\nWelcome to your Smart Shopping Companion! How can I assist you today? Are you looking for specific shoes, or do you have any preferences in mind? ðŸ‘Ÿâœ¨', refusal=None, role='assistant', audio=None, function_call=None, tool_calls=None, annotations=[]), content_filter_results={'hate': {'filtered': False, 'severity': 'safe'}, 'self_harm': {'filtered': False, 'severity': 'safe'}, 'sexual': {'filtered': False, 'severity': 'safe'}, 'violence': {'filtered': False, 'severity': 'safe'}})], created=1764180691, model='gpt-4o-mini-2024-07-18', object='chat.completion', service_tier=None, system_fingerprint='fp_efad92c60b', usage=CompletionUsage(completion_tokens=40, prompt_tokens=521, total_tokens=561, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)), prompt_filter_results=[{'prompt_index': 0, 'content_filter_results': {'hate': {'filtered': False, 'severity': 'safe'}, 'self_harm': {'filtered': False, 'severity': 'safe'}, 'sexual': {'filtered': False, 'severity': 'safe'}, 'violence': {'filtered': False, 'severity': 'safe'}}}])
Assistant message: ## ðŸ‘‹ Hello There!

Welcome to your Smart Shopping Companion! How can I assist you today? Are you looking for specific shoes, or do you have any preferences in mind? ðŸ‘Ÿâœ¨
Message type: <class 'str'>
Error storing message: (Unauthorized) The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:11:32 gmt

'
ActivityId: 7d91a16c-f1d3-40a5-9606-3bb7884b1580, Microsoft.Azure.Documents.Common/2.14.0
Code: Unauthorized
Message: The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:11:32 gmt

'
ActivityId: 7d91a16c-f1d3-40a5-9606-3bb7884b1580, Microsoft.Azure.Documents.Common/2.14.0
Error storing message: (Unauthorized) The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:11:32 gmt

'
ActivityId: 0d517037-b2ab-4824-9074-2e1276a237a7, Microsoft.Azure.Documents.Common/2.14.0
Code: Unauthorized
Message: The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:11:32 gmt

'
ActivityId: 0d517037-b2ab-4824-9074-2e1276a237a7, Microsoft.Azure.Documents.Common/2.14.0
INFO:     127.0.0.1:62563 - "POST /process-chat HTTP/1.1" 200 OK
Error fetching preferences: (Unauthorized) The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
docs
dbs/browsing-companion-db/colls/preferences/docs/test
wed, 26 nov 2025 18:11:47 gmt

'
ActivityId: f34cbda1-d66b-4d10-93d1-a755b2e5032c, Microsoft.Azure.Documents.Common/2.14.0
Code: Unauthorized
Message: The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
docs
dbs/browsing-companion-db/colls/preferences/docs/test
wed, 26 nov 2025 18:11:47 gmt

'
ActivityId: f34cbda1-d66b-4d10-93d1-a755b2e5032c, Microsoft.Azure.Documents.Common/2.14.0
OpenAI Response: ChatCompletion(id='chatcmpl-CgEHURCCGJkYDvZHcE8JAd1rjOFe1', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content="## âš¡ Testing Mode\n\nIt seems you're testing the system! If you have any specific questions or need assistance with finding shoes, feel free to let me know! ðŸ‘Ÿâœ¨\n\n### ðŸŽ¯ My Recommendation\nJust say the word, and I'll help you find the perfect pair of shoes!", refusal=None, role='assistant', audio=None, function_call=None, tool_calls=None, annotations=[]), content_filter_results={'hate': {'filtered': False, 'severity': 'safe'}, 'self_harm': {'filtered': False, 'severity': 'safe'}, 'sexual': {'filtered': False, 'severity': 'safe'}, 'violence': {'filtered': False, 'severity': 'safe'}})], created=1764180708, model='gpt-4o-mini-2024-07-18', object='chat.completion', service_tier=None, system_fingerprint='fp_efad92c60b', usage=CompletionUsage(completion_tokens=60, prompt_tokens=521, total_tokens=581, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)), prompt_filter_results=[{'prompt_index': 0, 'content_filter_results': {'hate': {'filtered': False, 'severity': 'safe'}, 'self_harm': {'filtered': False, 'severity': 'safe'}, 'sexual': {'filtered': False, 'severity': 'safe'}, 'violence': {'filtered': False, 'severity': 'safe'}}}])
Assistant message: ## âš¡ Testing Mode

It seems you're testing the system! If you have any specific questions or need assistance with finding shoes, feel free to let me know! ðŸ‘Ÿâœ¨

### ðŸŽ¯ My Recommendation
Just say the word, and I'll help you find the perfect pair of shoes!
Message type: <class 'str'>
Error storing message: (Unauthorized) The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:11:49 gmt

'
ActivityId: 7c0054f2-ba9f-406c-8c29-46810e4c6703, Microsoft.Azure.Documents.Common/2.14.0
Code: Unauthorized
Message: The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:11:49 gmt

'
ActivityId: 7c0054f2-ba9f-406c-8c29-46810e4c6703, Microsoft.Azure.Documents.Common/2.14.0
Error storing message: (Unauthorized) The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:11:49 gmt

'
ActivityId: 2a2a9474-4980-4e54-b2cf-624447fd0d7f, Microsoft.Azure.Documents.Common/2.14.0
Code: Unauthorized
Message: The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:11:49 gmt

'
ActivityId: 2a2a9474-4980-4e54-b2cf-624447fd0d7f, Microsoft.Azure.Documents.Common/2.14.0
INFO:     127.0.0.1:62676 - "POST /process-chat HTTP/1.1" 200 OK
