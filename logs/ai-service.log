INFO:     Will watch for changes in these directories: ['/Users/doruit/Browsing-Companion-DOM-snapshot-injection/services/ai-service']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [19488] using WatchFiles
INFO:     Started server process [19559]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     127.0.0.1:62561 - "GET /utility/recipe-images/random?count=10&t=1764180689685 HTTP/1.1" 404 Not Found
Error fetching preferences: (Unauthorized) The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
docs
dbs/browsing-companion-db/colls/preferences/docs/test
wed, 26 nov 2025 18:11:29 gmt

'
ActivityId: 6630726b-7e7a-4de1-a2df-182e16820d01, Microsoft.Azure.Documents.Common/2.14.0
Code: Unauthorized
Message: The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
docs
dbs/browsing-companion-db/colls/preferences/docs/test
wed, 26 nov 2025 18:11:29 gmt

'
ActivityId: 6630726b-7e7a-4de1-a2df-182e16820d01, Microsoft.Azure.Documents.Common/2.14.0
OpenAI Response: ChatCompletion(id='chatcmpl-CgEHD21eoC3xMfhS2NInQL7gLnRHr', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content='## ðŸ‘‹ Hello There!\n\nWelcome to your Smart Shopping Companion! How can I assist you today? Are you looking for specific shoes, or do you have any preferences in mind? ðŸ‘Ÿâœ¨', refusal=None, role='assistant', audio=None, function_call=None, tool_calls=None, annotations=[]), content_filter_results={'hate': {'filtered': False, 'severity': 'safe'}, 'self_harm': {'filtered': False, 'severity': 'safe'}, 'sexual': {'filtered': False, 'severity': 'safe'}, 'violence': {'filtered': False, 'severity': 'safe'}})], created=1764180691, model='gpt-4o-mini-2024-07-18', object='chat.completion', service_tier=None, system_fingerprint='fp_efad92c60b', usage=CompletionUsage(completion_tokens=40, prompt_tokens=521, total_tokens=561, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)), prompt_filter_results=[{'prompt_index': 0, 'content_filter_results': {'hate': {'filtered': False, 'severity': 'safe'}, 'self_harm': {'filtered': False, 'severity': 'safe'}, 'sexual': {'filtered': False, 'severity': 'safe'}, 'violence': {'filtered': False, 'severity': 'safe'}}}])
Assistant message: ## ðŸ‘‹ Hello There!

Welcome to your Smart Shopping Companion! How can I assist you today? Are you looking for specific shoes, or do you have any preferences in mind? ðŸ‘Ÿâœ¨
Message type: <class 'str'>
Error storing message: (Unauthorized) The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:11:32 gmt

'
ActivityId: 7d91a16c-f1d3-40a5-9606-3bb7884b1580, Microsoft.Azure.Documents.Common/2.14.0
Code: Unauthorized
Message: The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:11:32 gmt

'
ActivityId: 7d91a16c-f1d3-40a5-9606-3bb7884b1580, Microsoft.Azure.Documents.Common/2.14.0
Error storing message: (Unauthorized) The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:11:32 gmt

'
ActivityId: 0d517037-b2ab-4824-9074-2e1276a237a7, Microsoft.Azure.Documents.Common/2.14.0
Code: Unauthorized
Message: The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:11:32 gmt

'
ActivityId: 0d517037-b2ab-4824-9074-2e1276a237a7, Microsoft.Azure.Documents.Common/2.14.0
INFO:     127.0.0.1:62563 - "POST /process-chat HTTP/1.1" 200 OK
Error fetching preferences: (Unauthorized) The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
docs
dbs/browsing-companion-db/colls/preferences/docs/test
wed, 26 nov 2025 18:11:47 gmt

'
ActivityId: f34cbda1-d66b-4d10-93d1-a755b2e5032c, Microsoft.Azure.Documents.Common/2.14.0
Code: Unauthorized
Message: The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
docs
dbs/browsing-companion-db/colls/preferences/docs/test
wed, 26 nov 2025 18:11:47 gmt

'
ActivityId: f34cbda1-d66b-4d10-93d1-a755b2e5032c, Microsoft.Azure.Documents.Common/2.14.0
OpenAI Response: ChatCompletion(id='chatcmpl-CgEHURCCGJkYDvZHcE8JAd1rjOFe1', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content="## âš¡ Testing Mode\n\nIt seems you're testing the system! If you have any specific questions or need assistance with finding shoes, feel free to let me know! ðŸ‘Ÿâœ¨\n\n### ðŸŽ¯ My Recommendation\nJust say the word, and I'll help you find the perfect pair of shoes!", refusal=None, role='assistant', audio=None, function_call=None, tool_calls=None, annotations=[]), content_filter_results={'hate': {'filtered': False, 'severity': 'safe'}, 'self_harm': {'filtered': False, 'severity': 'safe'}, 'sexual': {'filtered': False, 'severity': 'safe'}, 'violence': {'filtered': False, 'severity': 'safe'}})], created=1764180708, model='gpt-4o-mini-2024-07-18', object='chat.completion', service_tier=None, system_fingerprint='fp_efad92c60b', usage=CompletionUsage(completion_tokens=60, prompt_tokens=521, total_tokens=581, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)), prompt_filter_results=[{'prompt_index': 0, 'content_filter_results': {'hate': {'filtered': False, 'severity': 'safe'}, 'self_harm': {'filtered': False, 'severity': 'safe'}, 'sexual': {'filtered': False, 'severity': 'safe'}, 'violence': {'filtered': False, 'severity': 'safe'}}}])
Assistant message: ## âš¡ Testing Mode

It seems you're testing the system! If you have any specific questions or need assistance with finding shoes, feel free to let me know! ðŸ‘Ÿâœ¨

### ðŸŽ¯ My Recommendation
Just say the word, and I'll help you find the perfect pair of shoes!
Message type: <class 'str'>
Error storing message: (Unauthorized) The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:11:49 gmt

'
ActivityId: 7c0054f2-ba9f-406c-8c29-46810e4c6703, Microsoft.Azure.Documents.Common/2.14.0
Code: Unauthorized
Message: The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:11:49 gmt

'
ActivityId: 7c0054f2-ba9f-406c-8c29-46810e4c6703, Microsoft.Azure.Documents.Common/2.14.0
Error storing message: (Unauthorized) The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:11:49 gmt

'
ActivityId: 2a2a9474-4980-4e54-b2cf-624447fd0d7f, Microsoft.Azure.Documents.Common/2.14.0
Code: Unauthorized
Message: The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:11:49 gmt

'
ActivityId: 2a2a9474-4980-4e54-b2cf-624447fd0d7f, Microsoft.Azure.Documents.Common/2.14.0
INFO:     127.0.0.1:62676 - "POST /process-chat HTTP/1.1" 200 OK
Error fetching preferences: (Unauthorized) The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
docs
dbs/browsing-companion-db/colls/preferences/docs/b2b-user
wed, 26 nov 2025 18:12:18 gmt

'
ActivityId: 57eaa210-d645-4634-9357-42da49cc5dda, Microsoft.Azure.Documents.Common/2.14.0
Code: Unauthorized
Message: The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
docs
dbs/browsing-companion-db/colls/preferences/docs/b2b-user
wed, 26 nov 2025 18:12:18 gmt

'
ActivityId: 57eaa210-d645-4634-9357-42da49cc5dda, Microsoft.Azure.Documents.Common/2.14.0
OpenAI Response: ChatCompletion(id='chatcmpl-CgEHzfLBXCyIAjf8A07BoEU72eGhI', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content="## ðŸ‘Ÿ Products I Can See\n\nHere are the shoes currently visible on your screen:\n\n1. **Classic Leather Oxford** \n   - Price: `$129.99`\n   - Category: Formal\n   - âœ¨ Timeless leather oxford shoes perfect for business meetings and formal occasions\n\n2. **Air Cushion Running Shoes** \n   - Price: `$89.99`\n   - Category: Athletic\n   - âœ¨ Lightweight running shoes with advanced air cushioning technology (15% off)\n\n3. **Professional Safety Boots** \n   - Price: `$159.99`\n   - Category: Work\n   - âœ¨ Steel-toe safety boots meeting OSHA standards for workplace protection (20% off)\n\n4. **Canvas Low-Top Sneakers** \n   - Price: `$49.99`\n   - Category: Casual\n   - âœ¨ Comfortable canvas sneakers for everyday casual wear\n\n5. **Premium Hiking Boots** \n   - Price: `$199.99`\n   - Category: Outdoor\n   - âœ¨ Waterproof hiking boots with excellent ankle support for mountain trails (10% off)\n\n6. **Ballet Flat Comfort** \n   - Price: `$59.99`\n   - Category: Casual\n   - âœ¨ Elegant ballet flats with memory foam insole for all-day comfort\n\n7. **High-Performance Basketball** \n   - Price: `$149.99`\n   - Category: Athletic\n   - âœ¨ Professional basketball shoes with responsive cushioning and grip (25% off)\n\n8. **Dress Loafers Premium** \n   - Price: `$119.99`\n   - Category: Formal\n   - âœ¨ Slip-on leather loafers combining comfort with sophisticated style\n\n### ðŸŽ¯ My Recommendation\nFor B2B purchases, the **Professional Safety Boots** and **Classic Leather Oxford** are excellent choices, especially if you're looking for quality and compliance with workplace standards! If you're interested, let me know and I can help you filter the options further!", refusal=None, role='assistant', audio=None, function_call=None, tool_calls=None, annotations=[]), content_filter_results={'hate': {'filtered': False, 'severity': 'safe'}, 'self_harm': {'filtered': False, 'severity': 'safe'}, 'sexual': {'filtered': False, 'severity': 'safe'}, 'violence': {'filtered': False, 'severity': 'safe'}})], created=1764180739, model='gpt-4o-mini-2024-07-18', object='chat.completion', service_tier=None, system_fingerprint='fp_efad92c60b', usage=CompletionUsage(completion_tokens=402, prompt_tokens=856, total_tokens=1258, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)), prompt_filter_results=[{'prompt_index': 0, 'content_filter_results': {'hate': {'filtered': False, 'severity': 'safe'}, 'self_harm': {'filtered': False, 'severity': 'safe'}, 'sexual': {'filtered': False, 'severity': 'safe'}, 'violence': {'filtered': False, 'severity': 'safe'}}}])
Assistant message: ## ðŸ‘Ÿ Products I Can See

Here are the shoes currently visible on your screen:

1. **Classic Leather Oxford** 
   - Price: `$129.99`
   - Category: Formal
   - âœ¨ Timeless leather oxford shoes perfect for business meetings and formal occasions

2. **Air Cushion Running Shoes** 
   - Price: `$89.99`
   - Category: Athletic
   - âœ¨ Lightweight running shoes with advanced air cushioning technology (15% off)

3. **Professional Safety Boots** 
   - Price: `$159.99`
   - Category: Work
   - âœ¨ Steel-toe safety boots meeting OSHA standards for workplace protection (20% off)

4. **Canvas Low-Top Sneakers** 
   - Price: `$49.99`
   - Category: Casual
   - âœ¨ Comfortable canvas sneakers for everyday casual wear

5. **Premium Hiking Boots** 
   - Price: `$199.99`
   - Category: Outdoor
   - âœ¨ Waterproof hiking boots with excellent ankle support for mountain trails (10% off)

6. **Ballet Flat Comfort** 
   - Price: `$59.99`
   - Category: Casual
   - âœ¨ Elegant ballet flats with memory foam insole for all-day comfort

7. **High-Performance Basketball** 
   - Price: `$149.99`
   - Category: Athletic
   - âœ¨ Professional basketball shoes with responsive cushioning and grip (25% off)

8. **Dress Loafers Premium** 
   - Price: `$119.99`
   - Category: Formal
   - âœ¨ Slip-on leather loafers combining comfort with sophisticated style

### ðŸŽ¯ My Recommendation
For B2B purchases, the **Professional Safety Boots** and **Classic Leather Oxford** are excellent choices, especially if you're looking for quality and compliance with workplace standards! If you're interested, let me know and I can help you filter the options further!
Message type: <class 'str'>
Error storing message: (Unauthorized) The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:12:33 gmt

'
ActivityId: 3cfce54f-6859-48a8-961f-c72ab073c230, Microsoft.Azure.Documents.Common/2.14.0
Code: Unauthorized
Message: The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:12:33 gmt

'
ActivityId: 3cfce54f-6859-48a8-961f-c72ab073c230, Microsoft.Azure.Documents.Common/2.14.0
Error storing message: (Unauthorized) The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:12:33 gmt

'
ActivityId: f7e75b62-1819-423d-b191-fdd092f956b2, Microsoft.Azure.Documents.Common/2.14.0
Code: Unauthorized
Message: The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:12:33 gmt

'
ActivityId: f7e75b62-1819-423d-b191-fdd092f956b2, Microsoft.Azure.Documents.Common/2.14.0
INFO:     127.0.0.1:62877 - "POST /process-chat HTTP/1.1" 200 OK
INFO:     127.0.0.1:63091 - "GET /utility/recipe-images/random?count=10&t=1764180778780 HTTP/1.1" 404 Not Found
Error fetching preferences: (Unauthorized) The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
docs
dbs/browsing-companion-db/colls/preferences/docs/b2b-user
wed, 26 nov 2025 18:13:00 gmt

'
ActivityId: c850096b-0598-4e31-b6a9-74379891e7c5, Microsoft.Azure.Documents.Common/2.14.0
Code: Unauthorized
Message: The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
docs
dbs/browsing-companion-db/colls/preferences/docs/b2b-user
wed, 26 nov 2025 18:13:00 gmt

'
ActivityId: c850096b-0598-4e31-b6a9-74379891e7c5, Microsoft.Azure.Documents.Common/2.14.0
Error fetching conversation history: (Unauthorized) The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'post
docs
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:13:00 gmt

'
ActivityId: 0f4c3d56-942c-486e-bebb-d8f522a86109, Microsoft.Azure.Documents.Common/2.14.0
Code: Unauthorized
Message: The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'post
docs
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:13:00 gmt

'
ActivityId: 0f4c3d56-942c-486e-bebb-d8f522a86109, Microsoft.Azure.Documents.Common/2.14.0
OpenAI Response: ChatCompletion(id='chatcmpl-CgEIfbSUL1xuoUgJlRHOFRJyl9ou6', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content="## ðŸ“‚ Selected Category\n\nThe currently selected category is **formal**. \n\nIf you're looking for something different or have specific preferences in mind, feel free to let me know! ðŸ˜Š", refusal=None, role='assistant', audio=None, function_call=None, tool_calls=None, annotations=[]), content_filter_results={'hate': {'filtered': False, 'severity': 'safe'}, 'self_harm': {'filtered': False, 'severity': 'safe'}, 'sexual': {'filtered': False, 'severity': 'safe'}, 'violence': {'filtered': False, 'severity': 'safe'}})], created=1764180781, model='gpt-4o-mini-2024-07-18', object='chat.completion', service_tier=None, system_fingerprint='fp_efad92c60b', usage=CompletionUsage(completion_tokens=38, prompt_tokens=774, total_tokens=812, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)), prompt_filter_results=[{'prompt_index': 0, 'content_filter_results': {'hate': {'filtered': False, 'severity': 'safe'}, 'self_harm': {'filtered': False, 'severity': 'safe'}, 'sexual': {'filtered': False, 'severity': 'safe'}, 'violence': {'filtered': False, 'severity': 'safe'}}}])
Assistant message: ## ðŸ“‚ Selected Category

The currently selected category is **formal**. 

If you're looking for something different or have specific preferences in mind, feel free to let me know! ðŸ˜Š
Message type: <class 'str'>
Error storing message: (Unauthorized) The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:13:02 gmt

'
ActivityId: bfb42758-4ea6-48f4-9de4-62453fbedc88, Microsoft.Azure.Documents.Common/2.14.0
Code: Unauthorized
Message: The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:13:02 gmt

'
ActivityId: bfb42758-4ea6-48f4-9de4-62453fbedc88, Microsoft.Azure.Documents.Common/2.14.0
Error storing message: (Unauthorized) The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:13:02 gmt

'
ActivityId: d62a441b-e5a3-44fb-b044-3776f41799b1, Microsoft.Azure.Documents.Common/2.14.0
Code: Unauthorized
Message: The input authorization token can't serve the request. The wrong key is being used or the expected payload is not built as per the protocol. For more info: https://aka.ms/cosmosdb-tsg-unauthorized. Server used the following payload to sign: 'get
colls
dbs/browsing-companion-db/colls/chat-sessions
wed, 26 nov 2025 18:13:02 gmt

'
ActivityId: d62a441b-e5a3-44fb-b044-3776f41799b1, Microsoft.Azure.Documents.Common/2.14.0
INFO:     127.0.0.1:63101 - "POST /process-chat HTTP/1.1" 200 OK
